var Ge=Object.defineProperty,$e=Object.defineProperties;var Xe=Object.getOwnPropertyDescriptors;var ce=Object.getOwnPropertySymbols;var Se=Object.prototype.hasOwnProperty,Be=Object.prototype.propertyIsEnumerable;var Ae=(e,n,t)=>n in e?Ge(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,B=(e,n)=>{for(var t in n||(n={}))Se.call(n,t)&&Ae(e,t,n[t]);if(ce)for(var t of ce(n))Be.call(n,t)&&Ae(e,t,n[t]);return e},De=(e,n)=>$e(e,Xe(n));var de=(e,n)=>{var t={};for(var o in e)Se.call(e,o)&&n.indexOf(o)<0&&(t[o]=e[o]);if(e!=null&&ce)for(var o of ce(e))n.indexOf(o)<0&&Be.call(e,o)&&(t[o]=e[o]);return t};import{d as ye,p as ze,r as d,i as Je,a as M,c as ge,w as _e,o as Ze,u as j,b as oe,e as ue,t as H,f as en,g as he,h as re,F as xe,j as Ne,k as nn,l as tn}from"./index.b05aa6b9.js";const on={},Pe=Symbol("GLOBAL_OPTIONS_PROVIDE_KEY"),un=()=>on;ye({name:"RequestConfig",props:{config:{type:Object,required:!0}},setup(e,{slots:n}){const{config:t}=e;return ze(Pe,t),()=>{var o;return(o=n.default)===null||o===void 0?void 0:o.call(n)}}});const rn=Object.prototype.toString,Qe=e=>rn.call(e),an=e=>Qe(e)==="[object String]",sn=e=>Qe(e)==="[object Object]",Oe=e=>e!==null&&typeof e=="object",ln=e=>Oe(e)&&pe(e.then)&&pe(e.catch),pe=e=>e instanceof Function,me=e=>e==null,Re=typeof window=="undefined",be=()=>{var e,n;return!Re&&((e=window)===null||e===void 0||(n=e.document)===null||n===void 0?void 0:n.visibilityState)==="visible"},ke=()=>{var e,n,t;return(e=!Re&&((n=window)===null||n===void 0||(t=n.navigator)===null||t===void 0?void 0:t.onLine))!==null&&e!==void 0?e:!0},cn=e=>{const n={};return Object.keys(e).forEach(t=>{n[t]=j(e[t])}),n},te=Promise.resolve(null),je=async(...e)=>{const n=await fetch(...e);if(n.ok)return n.json();throw new Error(n.statusText)};function dn(e,n){const t=Object.assign({},e);for(const o of n)delete t[o];return t}const fn=(e,n=!1)=>{const t=`Warning: [vue-request] ${e}`;if(n)return new Error(t);console.error(t)},vn=(e,n)=>{let t=!1;return(...o)=>{t||(t=!0,e(...o),setTimeout(()=>{t=!1},n))}};var Te;const We=new Set,qe=new Set,Ke=new Set,fe=(e,n)=>{let t;switch(e){case"FOCUS_LISTENER":t=We;break;case"RECONNECT_LISTENER":t=Ke;break;case"VISIBLE_LISTENER":t=qe;break}if(!t.has(n))return t.add(n),()=>{t.delete(n)}},Ce=e=>{e.forEach(n=>{n()})};!Re&&(Te=window)!==null&&Te!==void 0&&Te.addEventListener&&(window.addEventListener("visibilitychange",()=>{be()&&Ce(qe)},!1),window.addEventListener("focus",()=>Ce(We),!1),window.addEventListener("online",()=>Ce(Ke),!1));function Ve(e,n,t){let o,s,m,c,l,f,p=0,I=!1,F=!1,D=!0;const Y=!n&&n!==0&&typeof window.requestAnimationFrame=="function";if(typeof e!="function")throw new TypeError("Expected a function");n=+n||0,Oe(t)&&(I=!!t.leading,F="maxWait"in t,m=F?Math.max(+t.maxWait||0,n):m,D="trailing"in t?!!t.trailing:D);function w(i){const a=o,g=s;return o=s=void 0,p=i,c=e.apply(g,a),c}function b(i,a){return Y?(window.cancelAnimationFrame(l),window.requestAnimationFrame(i)):setTimeout(i,a)}function x(i){if(Y)return window.cancelAnimationFrame(i);clearTimeout(i)}function _(i){return p=i,l=b(O,n),I?w(i):c}function P(i){const a=i-f,g=i-p,y=n-a;return F?Math.min(y,m-g):y}function G(i){const a=i-f,g=i-p;return f===void 0||a>=n||a<0||F&&g>=m}function O(){const i=Date.now();if(G(i))return Z(i);l=b(O,P(i))}function Z(i){return l=void 0,D&&o?w(i):(o=s=void 0,c)}function L(){l!==void 0&&x(l),p=0,o=f=s=l=void 0}function Q(){return l===void 0?c:Z(Date.now())}function W(){return l!==void 0}function T(...i){const a=Date.now(),g=G(a);if(o=i,s=this,f=a,g){if(l===void 0)return _(f);if(F)return l=b(O,n),w(f)}return l===void 0&&(l=b(O,n)),c}return T.cancel=L,T.flush=Q,T.pending=W,T}function mn(e,n,t){let o=!0,s=!0;if(typeof e!="function")throw new TypeError("Expected a function");return Oe(t)&&(o="leading"in t?!!t.leading:o,s="trailing"in t?!!t.trailing:s),Ve(e,n,{leading:o,trailing:s,maxWait:n})}const En=(e,n)=>t=>{Object.keys(t).forEach(o=>{e[o].value=t[o]}),n.forEach(o=>o(e))},ve=(e,n,t)=>{var o,s,m;const{initialAutoRunFlag:c,initialData:l,loadingDelay:f,pollingInterval:p,debounceInterval:I,debounceOptions:F,throttleInterval:D,throttleOptions:Y,pollingWhenHidden:w,pollingWhenOffline:b,errorRetryCount:x,errorRetryInterval:_,stopPollingWhenHiddenOrOffline:P,refreshOnWindowFocus:G,refocusTimespan:O,updateCache:Z,formatResult:L,onSuccess:Q,onError:W,onBefore:T,onAfter:i}=n,a=d(0),g=d((o=t==null?void 0:t.loading)!==null&&o!==void 0?o:!1),y=d((s=t==null?void 0:t.data)!==null&&s!==void 0?s:l),N=d(t==null?void 0:t.error),q=d((m=t==null?void 0:t.params)!==null&&m!==void 0?m:[]),A=En({loading:g,data:y,error:N,params:q},[r=>Z(r)]),$=()=>{a.value=0},k=d(0),X=d(),ee=d(),z=d(),ie=()=>{X.value&&X.value(),z.value&&z.value(),ee.value&&ee.value()},ne=()=>{let r;return f&&(r=setTimeout(A,f,{loading:!0})),()=>r&&clearTimeout(r)},ae=r=>{if(N.value&&x!==0)return;let h;if(!me(p)&&p>=0)if((w||be())&&(b||ke()))h=setTimeout(r,p);else{P.value=!0;return}return()=>h&&clearTimeout(h)},se=ge(()=>{if(_)return _;const r=1e3,h=1,C=9,U=Math.floor(Math.random()*2**Math.min(a.value,C)+h);return r*U}),u=r=>{let h;const C=x===-1,U=a.value<x;return N.value&&(C||U)&&(C||(a.value+=1),h=setTimeout(r,se.value)),()=>h&&clearTimeout(h)},E=(...r)=>{A({loading:!f,params:r}),z.value=ne(),k.value+=1;const h=k.value;return T==null||T(r),e(...r).then(C=>{if(h===k.value){const U=L?L(C):C;return A({data:U,loading:!1,error:void 0}),Q&&Q(U,r),$(),U}return te}).catch(C=>(h===k.value&&(A({data:void 0,loading:!1,error:C}),W&&W(C,r),console.error(C)),te)).finally(()=>{h===k.value&&(z.value(),ee.value=u(()=>E(...r)),X.value=ae(()=>E(...r)),i==null||i(r))})},v=!me(I)&&Ve(E,I,F),R=!me(D)&&mn(E,D,Y),S=(...r)=>(ie(),!c.value&&v?(v(...r),te):R?(R(...r),te):($(),E(...r))),K=()=>{k.value+=1,A({loading:!1}),v&&v.cancel(),R&&R.cancel(),ie()},V=()=>S(...q.value),Ye=r=>{const h=pe(r)?r(y.value):r;A({data:h})},Ie=[],le=r=>{r&&Ie.push(r)},Fe=()=>{P.value&&(w||be())&&(b||ke())&&(V(),P.value=!1)};w||le(fe("VISIBLE_LISTENER",Fe)),b||le(fe("RECONNECT_LISTENER",Fe));const Le=vn(V,O);return G&&(le(fe("VISIBLE_LISTENER",Le)),le(fe("FOCUS_LISTENER",Le))),{loading:g,data:y,error:N,params:q,run:S,cancel:K,refresh:V,mutate:Ye,unmount:()=>{Ie.forEach(r=>r())}}},Ee=new Map,we=e=>{if(me(e))return;const n=Ee.get(e);if(!!n)return{data:n.data,cacheTime:n.cacheTime}},gn=(e,n,t)=>{const o=Ee.get(e);o!=null&&o.timer&&clearTimeout(o.timer);const s=setTimeout(()=>Ee.delete(e),t);Ee.set(e,{data:n,timer:s,cacheTime:new Date().getTime()})},J="__QUERY_DEFAULT_KEY__";function hn(e,n){const t=Je(Pe,{}),se=B(B(B({},un()),t),n),{cacheKey:o,defaultParams:s=[],manual:m=!1,ready:c=d(!0),refreshDeps:l=[],loadingDelay:f=0,pollingWhenHidden:p=!1,pollingWhenOffline:I=!1,refreshOnWindowFocus:F=!1,refocusTimespan:D=5e3,cacheTime:Y=6e5,staleTime:w=0,errorRetryCount:b=0,errorRetryInterval:x=0,queryKey:_}=se,P=de(se,["cacheKey","defaultParams","manual","ready","refreshDeps","loadingDelay","pollingWhenHidden","pollingWhenOffline","refreshOnWindowFocus","refocusTimespan","cacheTime","staleTime","errorRetryCount","errorRetryInterval","queryKey"]),G=d(!1),O=d(!1),L=B({initialAutoRunFlag:O,loadingDelay:f,pollingWhenHidden:p,pollingWhenOffline:I,stopPollingWhenHiddenOrOffline:G,cacheKey:o,errorRetryCount:b,errorRetryInterval:x,refreshOnWindowFocus:F,refocusTimespan:D,updateCache:u=>{var E,v;if(!o)return;const R=(E=we(o))===null||E===void 0?void 0:E.data,S=R==null?void 0:R.queries,K=cn(u),V=(v=_==null?void 0:_(...u.params.value))!==null&&v!==void 0?v:J;gn(o,{queries:De(B({},S),{[V]:B(B({},S==null?void 0:S[V]),K)}),latestQueriesKey:V},Y)}},dn(P,["pagination","listKey"])),Q=d(!1),W=d(),T=d(),i=d(),a=M({[J]:M(ve(e,L))}),g=d(J),y=ge(()=>{var u;return(u=a[g.value])!==null&&u!==void 0?u:{}});if(_e(y,u=>{Q.value=u.loading,W.value=u.data,T.value=u.error,i.value=u.params},{immediate:!0,deep:!0}),o){var N;const u=we(o);u!=null&&(N=u.data)!==null&&N!==void 0&&N.queries&&(Object.keys(u.data.queries).forEach(E=>{const v=u.data.queries[E];a[E]=M(ve(e,L,{loading:v.loading,params:v.params,data:v.data,error:v.error}))}),u.data.latestQueriesKey&&(g.value=u.data.latestQueriesKey))}const q=d(),A=d(!1),$=(...u)=>{var E;if(!c.value&&!A.value)return q.value=u,te;const v=(E=_==null?void 0:_(...u))!==null&&E!==void 0?E:J;return a[v]||(a[v]=M(ve(e,L))),g.value=v,y.value.run(...u)},k=()=>{X(),g.value=J,a[J]=M(ve(e,L))},X=()=>{Object.keys(a).forEach(u=>{a[u].cancel(),a[u].unmount(),delete a[u]})},ee=()=>y.value.cancel(),z=()=>y.value.refresh(),ie=u=>y.value.mutate(u);if(!m){var ne;O.value=!0;const u=we(o),E=(ne=u==null?void 0:u.data.queries)!==null&&ne!==void 0?ne:{},v=u&&(w===-1||u.cacheTime+w>new Date().getTime()),R=Object.keys(E).length>0;v||(R?Object.keys(a).forEach(S=>{var K;(K=a[S])===null||K===void 0||K.refresh()}):$(...s)),O.value=!1}const ae=d();return ae.value=_e(c,u=>{A.value=!0,u&&q.value&&($(...q.value),ae.value())},{flush:"sync"}),l.length&&_e(l,()=>{!m&&y.value.refresh()}),Ze(()=>{X()}),{loading:Q,data:W,error:T,params:i,cancel:ee,refresh:z,mutate:ie,run:$,reset:k,queries:a}}const Ue=e=>(...n)=>{if(pe(e))return Ue(e(...n))();if(ln(e))return e;if(sn(e)){const t=e,{url:o}=t,s=de(t,["url"]);return je(o,s)}else{if(an(e))return je(e);throw fn("Unknown service type",!0)}};function Me(e,n){const t=Ue(e),f=hn(t,n!=null?n:{}),{reset:o,run:s}=f,m=de(f,["reset","run"]),c=d(!1);return B({reload:async()=>{const{defaultParams:p=[],manual:I}=n;o(),I||(c.value=!0,await s(...p),c.value=!1)},run:s,reloading:c},m)}const He="",pn=()=>Me({url:He+"/api/post",method:"post"},{manual:!0,debounceInterval:500}),yn=()=>Me({url:He+"/api/get",method:"get"}),_n=ye({setup(e){const{data:n,loading:t,run:o}=pn(),{data:s}=yn(),m={name:ge(()=>{var f;return((f=n.value)==null?void 0:f.data.name)||void 0})},c=M({isLogin:ge(()=>!t.value&&m.name.value),text:"\u672A\u767B\u5F55"}),l=async()=>{c.text="\u767B\u5F55\u4E2D",o()};return(f,p)=>(oe(),ue("div",null,[j(c).isLogin?en("",!0):(oe(),ue("button",{key:0,onClick:l},H(j(c).text),1)),he("p",null,H(m.name),1),he("p",null,H(j(s)),1)]))}});var Tn=ye({setup(){const e=M({count:0}),n=()=>e.count++;return()=>re(xe,null,[re("span",null,[Ne(" tsx\u8BED\u6CD5\uFF1A")]),re("button",{onClick:n},[Ne("count: "),e.count])])}});const On=ye({setup(e){const n=nn({title:"\u767B\u9AD8",author:"\u675C\u752B",dynasty:"\u5510",content:["\u98CE\u6025\u5929\u9AD8\u733F\u5578\u54C0\uFF0C\u6E1A\u6E05\u6C99\u767D\u9E1F\u98DE\u56DE\u3002","\u65E0\u8FB9\u843D\u6728\u8427\u8427\u4E0B\uFF0C\u4E0D\u5C3D\u957F\u6C5F\u6EDA\u6EDA\u6765\u3002","\u4E07\u91CC\u60B2\u79CB\u5E38\u4F5C\u5BA2\uFF0C\u767E\u5E74\u591A\u75C5\u72EC\u767B\u53F0\u3002","\u8270\u96BE\u82E6\u6068\u7E41\u971C\u9B13\uFF0C\u6F66\u5012\u65B0\u505C\u6D4A\u9152\u676F\u3002"]});return(t,o)=>{const s=Tn,m=_n;return oe(),ue("div",null,[he("h2",null,"\u300A"+H(j(n).title)+"\u300B",1),he("h5",null,H(j(n).dynasty)+" \xB7 "+H(j(n).author),1),(oe(!0),ue(xe,null,tn(j(n).content,(c,l)=>(oe(),ue("p",{key:l},H(c),1))),128)),re(s),re(m)])}}});export{On as default};
